

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>server &mdash; lupyne 2.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="examples" href="examples.html" />
    <link rel="prev" title="engine" href="engine.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> lupyne
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="engine.html">engine</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tools">tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="#websearcher">WebSearcher</a></li>
<li class="toctree-l2"><a class="reference internal" href="#webindexer">WebIndexer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#start">start</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">examples</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">lupyne</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>server</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/server.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="server">
<h1>server<a class="headerlink" href="#server" title="Permalink to this headline">¶</a></h1>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>usage: lupyne.server [-h] [-r] [-c CONFIG] [-p FILE] [-d]
                     [--autoreload SECONDS] [--autoupdate SECONDS]
                     [--autosync URL,...] [--real-time]
                     [directory [directory ...]]

Restful json cherrypy server.

positional arguments:
  directory             index directories

optional arguments:
  -h, --help            show this help message and exit
  -r, --read-only       expose only read methods; no write lock
  -c CONFIG, --config CONFIG
                        optional configuration file or json object of global
                        params
  -p FILE, --pidfile FILE
                        store the process id in the given file
  -d, --daemonize       run the server as a daemon
  --autoreload SECONDS  automatically reload modules; replacement for
                        engine.autoreload
  --autoupdate SECONDS  automatically update index version and commit any
                        changes
  --autosync URL,...    automatically synchronize searcher with remote hosts
                        and update
  --real-time           search in real-time without committing
</pre></div>
</div>
<span class="target" id="module-lupyne.server"></span><p>Restful json <a class="reference external" href="http://cherrypy.org/">CherryPy</a> server.</p>
<p>The server script mounts a <a class="reference internal" href="#websearcher">WebSearcher</a> (read_only) or <a class="reference internal" href="#webindexer">WebIndexer</a> root.
Standard <a class="reference external" href="http://docs.cherrypy.org/en/latest/config.html">CherryPy configuration</a> applies,
and the provided <a class="reference external" href="#tools">custom tools</a> are also configurable.
All request and response bodies are <a class="reference external" href="http://tools.ietf.org/html/rfc4627.html#section-2.1">application/json values</a>.</p>
<p>WebSearcher exposes resources for an IndexSearcher.
In addition to search requests, it provides access to term and document information in the index.</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#lupyne.server.WebSearcher.index" title="lupyne.server.WebSearcher.index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">/</span></code></a></p></li>
<li><p><a class="reference internal" href="#lupyne.server.WebSearcher.search" title="lupyne.server.WebSearcher.search"><code class="xref py py-meth docutils literal notranslate"><span class="pre">/search</span></code></a></p></li>
<li><p><a class="reference internal" href="#lupyne.server.WebSearcher.docs" title="lupyne.server.WebSearcher.docs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">/docs</span></code></a></p></li>
<li><p><a class="reference internal" href="#lupyne.server.WebSearcher.terms" title="lupyne.server.WebSearcher.terms"><code class="xref py py-meth docutils literal notranslate"><span class="pre">/terms</span></code></a></p></li>
<li><p><a class="reference internal" href="#lupyne.server.WebSearcher.update" title="lupyne.server.WebSearcher.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">/update</span></code></a></p></li>
<li><p><a class="reference internal" href="#lupyne.server.WebSearcher.queries" title="lupyne.server.WebSearcher.queries"><code class="xref py py-meth docutils literal notranslate"><span class="pre">/queries</span></code></a></p></li>
</ul>
</div></blockquote>
<p>WebIndexer extends WebSearcher, exposing additional resources and methods for an Indexer.
Single documents may be added, deleted, or replaced by a unique indexed field.
Multiples documents may also be added or deleted by query at once.
By default changes are not visible until the update resource is called to commit a new index version.
If a near real-time Indexer is used, then changes are instantly searchable.
In such cases a commit still hasn’t occurred, and the index based <a class="reference internal" href="#lupyne.server.validate" title="lupyne.server.validate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">last-modified</span> <span class="pre">header</span></code></a> shouldn’t be used for caching.</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#lupyne.server.WebIndexer.index" title="lupyne.server.WebIndexer.index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">/</span></code></a></p></li>
<li><p><a class="reference internal" href="#lupyne.server.WebIndexer.search" title="lupyne.server.WebIndexer.search"><code class="xref py py-meth docutils literal notranslate"><span class="pre">/search</span></code></a></p></li>
<li><p><a class="reference internal" href="#lupyne.server.WebIndexer.docs" title="lupyne.server.WebIndexer.docs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">/docs</span></code></a></p></li>
<li><p><a class="reference internal" href="#lupyne.server.WebIndexer.fields" title="lupyne.server.WebIndexer.fields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">/fields</span></code></a></p></li>
<li><p><a class="reference internal" href="#lupyne.server.WebIndexer.update" title="lupyne.server.WebIndexer.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">/update</span></code></a></p></li>
</ul>
</div></blockquote>
<p>Custom servers should create and mount WebSearchers and WebIndexers as needed.
<a class="reference internal" href="#lupyne.server.WebSearcher.update" title="lupyne.server.WebSearcher.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Caches</span></code></a> and <a class="reference internal" href="#lupyne.server.WebIndexer.fields" title="lupyne.server.WebIndexer.fields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">field</span> <span class="pre">settings</span></code></a>
can then be applied directly before <a class="reference external" href="#start">starting</a> the server.
WebSearchers and WebIndexers can of course also be subclassed for custom interfaces.</p>
<p>CherryPy and Lucene VM integration issues:</p>
<blockquote>
<div><ul class="simple">
<li><p>Monitors (such as autoreload) are not compatible with the VM unless threads are attached.</p></li>
<li><p>WorkerThreads must be also attached to the VM.</p></li>
<li><p>VM initialization must occur after daemonizing.</p></li>
<li><p>Recommended that the VM ignores keyboard interrupts (-Xrs) for clean server shutdown.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Lucene doc ids are ephemeral;  only use doc ids across requests for the same index version.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Autosyncing is not recommended for production.</p>
</div>
<p>Lucene index files are incremental, so synchronizing files and refreshing searchers is a viable replication strategy.
The <cite>autoupdate</cite> and <cite>autosync</cite> features demonstrate this, but are not meant to recommend HTTP for file syncing.
Autoupdating is considered production-ready; autosyncing is not.</p>
<p>CherryPy was chosen because not only is it well suited to exposing APIs, but it includes a production multithreaded server.
Lucene caches heavily, and PyLucene is not bound by the <a class="reference external" href="https://docs.python.org/3/glossary.html#term-gil">GIL</a> when in the Java VM.
So threads are a natural choice for a worker pool, even if a different concurrency model is used for HTTP.</p>
<div class="section" id="tools">
<h2>tools<a class="headerlink" href="#tools" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://docs.cherrypy.org/en/latest/extend.html#tools">CherryPy tools</a> enabled by default:  tools.{json_in,json_out,allow,timer,validate}.on</p>
<dl class="function">
<dt id="lupyne.server.json_in">
<code class="sig-prename descclassname">lupyne.server.</code><code class="sig-name descname">json_in</code><span class="sig-paren">(</span><em class="sig-param">process_body=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#json_in"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.json_in" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle request bodies in json format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>content_type</strong> – request media type</p></li>
<li><p><strong>process_body</strong> – optional function to process body into request.params</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lupyne.server.json_out">
<code class="sig-prename descclassname">lupyne.server.</code><code class="sig-name descname">json_out</code><span class="sig-paren">(</span><em class="sig-param">content_type='application/json'</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#json_out"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.json_out" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle responses in json format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>content_type</strong> – response content-type header</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lupyne.server.allow">
<code class="sig-prename descclassname">lupyne.server.</code><code class="sig-name descname">allow</code><span class="sig-paren">(</span><em class="sig-param">methods=None</em>, <em class="sig-param">paths=()</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#allow"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.allow" title="Permalink to this definition">¶</a></dt>
<dd><p>Only allow specified methods.</p>
</dd></dl>

<dl class="function">
<dt id="lupyne.server.timer">
<code class="sig-prename descclassname">lupyne.server.</code><code class="sig-name descname">timer</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#timer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.timer" title="Permalink to this definition">¶</a></dt>
<dd><p>Return response time in headers.</p>
</dd></dl>

<dl class="function">
<dt id="lupyne.server.validate">
<code class="sig-prename descclassname">lupyne.server.</code><code class="sig-name descname">validate</code><span class="sig-paren">(</span><em class="sig-param">etag=True</em>, <em class="sig-param">last_modified=False</em>, <em class="sig-param">max_age=None</em>, <em class="sig-param">expires=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#validate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.validate" title="Permalink to this definition">¶</a></dt>
<dd><p>Return and validate caching headers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>etag</strong> – return weak entity tag header based on index version and validate if-match headers</p></li>
<li><p><strong>last_modified</strong> – return last-modified header based on index timestamp and validate if-modified headers</p></li>
<li><p><strong>max_age</strong> – return cache-control max-age and age headers based on last update timestamp</p></li>
<li><p><strong>expires</strong> – return expires header offset from last update timestamp</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="websearcher">
<h2>WebSearcher<a class="headerlink" href="#websearcher" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="lupyne.server.WebSearcher">
<em class="property">class </em><code class="sig-prename descclassname">lupyne.server.</code><code class="sig-name descname">WebSearcher</code><span class="sig-paren">(</span><em class="sig-param">*directories</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebSearcher"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebSearcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Dispatch root with a delegated Searcher.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>urls</strong> – ordered hosts to synchronize with</p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.2: </span>automatic synchronization and promotion</p>
</div>
<dl class="attribute">
<dt id="lupyne.server.WebSearcher.fields">
<code class="sig-name descname">fields</code><a class="headerlink" href="#lupyne.server.WebSearcher.fields" title="Permalink to this definition">¶</a></dt>
<dd><p>optional field settings will trigger indexer promotion when synchronized hosts are exhausted</p>
</dd></dl>

<dl class="attribute">
<dt id="lupyne.server.WebSearcher.autoupdate">
<code class="sig-name descname">autoupdate</code><a class="headerlink" href="#lupyne.server.WebSearcher.autoupdate" title="Permalink to this definition">¶</a></dt>
<dd><p>optional autoupdate timer for use upon indexer promotion</p>
</dd></dl>

<dl class="method">
<dt id="lupyne.server.WebSearcher.docs">
<code class="sig-name descname">docs</code><span class="sig-paren">(</span><em class="sig-param">name=None</em>, <em class="sig-param">value=''</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebSearcher.docs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebSearcher.docs" title="Permalink to this definition">¶</a></dt>
<dd><p>Return ids or documents.</p>
<dl>
<dt><strong>GET</strong> /docs</dt><dd><p>Return array of doc ids.</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>[<em>int</em>,… ]</p>
</dd>
</dl>
</dd>
<dt><strong>GET</strong> /docs/[<em>int</em>|<em>chars</em>/<em>chars</em>]?</dt><dd><p>Return document mapping from id or unique name and value.</p>
<dl class="simple">
<dt>&amp;fields=<em>chars</em>,… &amp;fields.multi=<em>chars</em>,… &amp;fields.docvalues=<em>chars</em>[:<em>chars</em>],…</dt><dd><p>optionally select stored, multi-valued, and docvalues</p>
</dd>
<dt>&amp;fields.vector=<em>chars</em>,… &amp;fields.vector.counts=<em>chars</em>,…</dt><dd><p>optionally select term vectors with term counts</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>{<em>string</em>: null|<em>string</em>|<em>number</em>|<em>array</em>|<em>object</em>,… }</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lupyne.server.WebSearcher.index">
<code class="sig-name descname">index</code><span class="sig-paren">(</span><em class="sig-param">url=''</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebSearcher.index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebSearcher.index" title="Permalink to this definition">¶</a></dt>
<dd><p>Return index information and synchronize with remote index.</p>
<dl>
<dt><strong>GET, POST</strong> /[index]</dt><dd><p>Return a mapping of the directory to the document count.
Add new segments from remote host.</p>
<p>{“url”: <em>string</em>}</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>{<em>string</em>: <em>int</em>,… }</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lupyne.server.WebSearcher.queries">
<code class="sig-name descname">queries</code><span class="sig-paren">(</span><em class="sig-param">name=''</em>, <em class="sig-param">value=''</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebSearcher.queries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebSearcher.queries" title="Permalink to this definition">¶</a></dt>
<dd><p>Match a document against registered queries.</p>
<p>Queries are cached by a unique name and value, suitable for document indexing.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<dl>
<dt><strong>GET</strong> /queries</dt><dd><p>Return query set names.</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>[<em>string</em>,… ]</p>
</dd>
</dl>
</dd>
<dt><strong>GET, POST</strong> /queries/<em>chars</em></dt><dd><p>Return query values and scores which match given document.</p>
<p>{<em>string</em>: <em>string</em>,… }</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>{<em>string</em>: <em>number</em>,… }</p>
</dd>
</dl>
</dd>
<dt><strong>GET, PUT, DELETE</strong> /queries/<em>chars</em>/<em>chars</em></dt><dd><p>Return, create, or delete a registered query.</p>
<p><em>string</em></p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p><em>string</em></p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lupyne.server.WebSearcher.search">
<code class="sig-name descname">search</code><span class="sig-paren">(</span><em class="sig-param">q=None</em>, <em class="sig-param">count: int = None</em>, <em class="sig-param">start: int = 0</em>, <em class="sig-param">fields: lupyne.server.multi = None</em>, <em class="sig-param">sort: lupyne.server.multi = None</em>, <em class="sig-param">facets: lupyne.server.multi = ''</em>, <em class="sig-param">group=''</em>, <em class="sig-param">hl: lupyne.server.multi = ''</em>, <em class="sig-param">mlt: int = None</em>, <em class="sig-param">timeout: float = None</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebSearcher.search"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebSearcher.search" title="Permalink to this definition">¶</a></dt>
<dd><p>Run query and return documents.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.3: </span>maxscore option and result removed</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.4: </span>__keys__ renamed to __sortkeys__</p>
</div>
<dl>
<dt><strong>GET</strong> /search?</dt><dd><p>Return array of document objects and total doc count.</p>
<dl>
<dt>&amp;q=<em>chars</em>&amp;q.type=[term|prefix|wildcard]&amp;q.spellcheck=true&amp;q.<em>chars</em>=…,</dt><dd><p>query, optional type to skip parsing, spellcheck, and parser settings: q.field, q.op,…</p>
</dd>
<dt>&amp;count=<em>int</em>&amp;start=0&amp;count.min=1000</dt><dd><p>maximum number of docs to return and offset to start at</p>
</dd>
<dt>&amp;fields=<em>chars</em>,… &amp;fields.multi=<em>chars</em>,… &amp;fields.docvalues=<em>chars</em>[:<em>chars</em>],…</dt><dd><p>only include selected stored fields; multi-valued fields returned in an array; docvalues fields</p>
</dd>
<dt>&amp;sort=[-]<em>chars</em>[:<em>chars</em>],… &amp;sort.scores</dt><dd><div class="line-block">
<div class="line">field name, optional type, minus sign indicates descending</div>
<div class="line">optionally score docs</div>
</div>
</dd>
<dt>&amp;facets=<em>chars</em>,… &amp;facets.count=<em>int</em>&amp;facets.min=0</dt><dd><div class="line-block">
<div class="line">include facet counts for given field names</div>
<div class="line">optional maximum number of most populated facet values per field, and minimum count to return</div>
</div>
</dd>
<dt>&amp;group=<em>chars</em>[:<em>chars</em>]&amp;group.count=1</dt><dd><div class="line-block">
<div class="line">group documents by field value with optional type, up to given maximum count</div>
</div>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6: </span>grouping searches use count and start options</p>
</div>
<dl>
<dt>&amp;hl=<em>chars</em>,… &amp;hl.count=1</dt><dd><div class="line-block">
<div class="line">stored fields to return highlighted</div>
<div class="line">optional maximum fragment count</div>
</div>
</dd>
<dt>&amp;mlt=<em>int</em>&amp;mlt.fields=<em>chars</em>,… &amp;mlt.<em>chars</em>=…,</dt><dd><div class="line-block">
<div class="line">doc index (or id without a query) to find MoreLikeThis</div>
<div class="line">optional document fields to match</div>
<div class="line">optional MoreLikeThis settings: mlt.minTermFreq, mlt.minDocFreq,…</div>
</div>
</dd>
<dt>&amp;timeout=<em>number</em></dt><dd><p>timeout search after elapsed number of seconds</p>
</dd>
</dl>
<dl class="field-list">
<dt class="field-odd">return</dt>
<dd class="field-odd"><div class="line-block">
<div class="line">{</div>
<div class="line">“query”: <em>string</em>|null,</div>
<div class="line">“count”: <em>int</em>|null,</div>
<div class="line">“docs”: [{“__id__”: <em>int</em>, “__score__”: <em>number</em>, “__sortkeys__”: <em>array</em>,
“__highlights__”: {<em>string</em>: <em>array</em>,… }, <em>string</em>: <em>value</em>,… },… ],</div>
<div class="line">“facets”: {<em>string</em>: {<em>string</em>: <em>int</em>,… },… },</div>
<div class="line">“groups”: [{“count”: <em>int</em>, “value”: <em>value</em>, “docs”: [<em>object</em>,… ]},… ]</div>
<div class="line">}</div>
</div>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lupyne.server.WebSearcher.terms">
<code class="sig-name descname">terms</code><span class="sig-paren">(</span><em class="sig-param">name=''</em>, <em class="sig-param">value='*'</em>, <em class="sig-param">*path</em>, <em class="sig-param">count: int = 0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebSearcher.terms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebSearcher.terms" title="Permalink to this definition">¶</a></dt>
<dd><p>Return data about indexed terms.</p>
<dl class="simple">
<dt><strong>GET</strong> /terms?</dt><dd><p>Return field names.</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>[<em>string</em>,… ]</p>
</dd>
</dl>
</dd>
<dt><strong>GET</strong> /terms/<em>chars</em></dt><dd><p>Return term values for given field name.</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>[<em>string</em>,… ]</p>
</dd>
</dl>
</dd>
<dt><strong>GET</strong> /terms/<em>chars</em>/<em>chars</em>[*|:<em>chars</em>|~[<em>int</em>]]</dt><dd><p>Return term values (prefix, slices, or fuzzy terms) for given field name.</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>[<em>string</em>,… ]</p>
</dd>
</dl>
</dd>
<dt><strong>GET</strong> /terms/<em>chars</em>/<em>chars</em>[*|~[<em>int</em>]]?count=<em>int</em></dt><dd><p>Return spellchecked term values ordered by decreasing document frequency.
Prefixes (*) are optimized to be suitable for real-time query suggestions; all terms are cached.</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>[<em>string</em>,… ]</p>
</dd>
</dl>
</dd>
<dt><strong>GET</strong> /terms/<em>chars</em>/<em>chars</em></dt><dd><p>Return document count for given term.</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p><em>int</em></p>
</dd>
</dl>
</dd>
<dt><strong>GET</strong> /terms/<em>chars</em>/<em>chars</em>/docs</dt><dd><p>Return document ids for given term.</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>[<em>int</em>,… ]</p>
</dd>
</dl>
</dd>
<dt><strong>GET</strong> /terms/<em>chars</em>/<em>chars</em>/docs/counts</dt><dd><p>Return document ids and frequency counts for given term.</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>[[<em>int</em>, <em>int</em>],… ]</p>
</dd>
</dl>
</dd>
<dt><strong>GET</strong> /terms/<em>chars</em>/<em>chars</em>/docs/positions</dt><dd><p>Return document ids and positions for given term.</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>[[<em>int</em>, [<em>int</em>,… ]],… ]</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lupyne.server.WebSearcher.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><em class="sig-param">**caches</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebSearcher.update"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebSearcher.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Refresh index version.</p>
<dl>
<dt><strong>POST</strong> /update</dt><dd><p>Reopen searcher, optionally reloading caches, and return document count.</p>
<p>{“spellcheckers”: true,… }</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.2: </span>request body is an object instead of an array</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p><em>int</em></p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="webindexer">
<h2>WebIndexer<a class="headerlink" href="#webindexer" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="lupyne.server.WebIndexer">
<em class="property">class </em><code class="sig-prename descclassname">lupyne.server.</code><code class="sig-name descname">WebIndexer</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebIndexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebIndexer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lupyne.server.WebSearcher" title="lupyne.server.WebSearcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">lupyne.server.WebSearcher</span></code></a></p>
<p>Dispatch root with a delegated Indexer, exposing write methods.</p>
<dl class="method">
<dt id="lupyne.server.WebIndexer.docs">
<code class="sig-name descname">docs</code><span class="sig-paren">(</span><em class="sig-param">name=None</em>, <em class="sig-param">value=''</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebIndexer.docs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebIndexer.docs" title="Permalink to this definition">¶</a></dt>
<dd><p>Add or return documents.  See <a class="reference internal" href="#lupyne.server.WebSearcher.docs" title="lupyne.server.WebSearcher.docs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WebSearcher.docs()</span></code></a> for GET method.</p>
<dl>
<dt><strong>POST</strong> /docs</dt><dd><p>Add documents to index.</p>
<p>[{<em>string</em>: <em>string</em>|<em>number</em>|<em>array</em>,… },… ]</p>
</dd>
<dt><strong>PUT, DELETE</strong> /docs/<em>chars</em>/<em>chars</em></dt><dd><p>Set or delete document.  Unique term should be indexed and is added to the new document.</p>
<p>{<em>string</em>: <em>string</em>|<em>number</em>|<em>array</em>,… }</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lupyne.server.WebIndexer.fields">
<code class="sig-name descname">fields</code><span class="sig-paren">(</span><em class="sig-param">name=''</em>, <em class="sig-param">**settings</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebIndexer.fields"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebIndexer.fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Return or store a field’s settings.</p>
<dl>
<dt><strong>GET</strong> /fields</dt><dd><p>Return known field names.</p>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>[<em>string</em>,… ]</p>
</dd>
</dl>
</dd>
<dt><strong>GET, PUT</strong> /fields/<em>chars</em></dt><dd><p>Set and return settings for given field name.</p>
<p>{“stored”|”indexOptions”|…: <em>string</em>|true|false,… }</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6: </span>lucene FieldType attributes used as settings</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>{“stored”|”indexOptions”|…: <em>string</em>|true|false,… }</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lupyne.server.WebIndexer.index">
<code class="sig-name descname">index</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebIndexer.index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebIndexer.index" title="Permalink to this definition">¶</a></dt>
<dd><p>Add indexes.  See <a class="reference internal" href="#lupyne.server.WebSearcher.index" title="lupyne.server.WebSearcher.index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WebSearcher.index()</span></code></a> for GET method.</p>
<dl>
<dt><strong>POST</strong> /[index]</dt><dd><p>Add indexes without optimization.</p>
<p>[<em>string</em>,… ]</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lupyne.server.WebIndexer.search">
<code class="sig-name descname">search</code><span class="sig-paren">(</span><em class="sig-param">q=None</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebIndexer.search"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebIndexer.search" title="Permalink to this definition">¶</a></dt>
<dd><p>Run or delete a query.  See <a class="reference internal" href="#lupyne.server.WebSearcher.search" title="lupyne.server.WebSearcher.search"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WebSearcher.search()</span></code></a> for GET method.</p>
<dl class="simple">
<dt><strong>DELETE</strong> /search?q=<em>chars</em></dt><dd><p>Delete documents which match query.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lupyne.server.WebIndexer.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><em class="sig-param">id=''</em>, <em class="sig-param">name=''</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#WebIndexer.update"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.WebIndexer.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Commit index changes and refresh index version.</p>
<dl>
<dt><strong>POST</strong> /update</dt><dd><p>Commit write operations and return document count.  See <a class="reference internal" href="#lupyne.server.WebSearcher.update" title="lupyne.server.WebSearcher.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WebSearcher.update()</span></code></a> for caching options.</p>
<p>{“merge”: true|<em>int</em>,… }</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.2: </span>request body is an object instead of an array</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p><em>int</em></p>
</dd>
</dl>
</dd>
<dt><strong>GET, PUT, DELETE</strong> /update/[snapshot|<em>int</em>]</dt><dd><p>Verify, create, or release unique snapshot of current index commit and return array of referenced filenames.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>lucene identifies snapshots by commit generation;  use location header</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><p>[<em>string</em>,… ]</p>
</dd>
</dl>
</dd>
<dt><strong>GET</strong> /update/<em>int</em>/<em>chars</em></dt><dd><p>Download index file corresponding to snapshot id and filename.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="start">
<h2>start<a class="headerlink" href="#start" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="lupyne.server.mount">
<code class="sig-prename descclassname">lupyne.server.</code><code class="sig-name descname">mount</code><span class="sig-paren">(</span><em class="sig-param">root</em>, <em class="sig-param">path=''</em>, <em class="sig-param">config=None</em>, <em class="sig-param">autoupdate=0</em>, <em class="sig-param">app=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#mount"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.mount" title="Permalink to this definition">¶</a></dt>
<dd><p>Attach root and subscribe to plugins.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>root</strong><strong>,</strong><strong>path</strong><strong>,</strong><strong>config</strong> – see cherrypy.tree.mount</p></li>
<li><p><strong>autoupdate</strong> – see command-line options</p></li>
<li><p><strong>app</strong> – optionally replace root on existing app</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lupyne.server.start">
<code class="sig-prename descclassname">lupyne.server.</code><code class="sig-name descname">start</code><span class="sig-paren">(</span><em class="sig-param">root=None</em>, <em class="sig-param">path=''</em>, <em class="sig-param">config=None</em>, <em class="sig-param">pidfile=''</em>, <em class="sig-param">daemonize=False</em>, <em class="sig-param">autoreload=0</em>, <em class="sig-param">autoupdate=0</em>, <em class="sig-param">callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lupyne/server.html#start"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lupyne.server.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Attach root, subscribe to plugins, and start server.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>root</strong><strong>,</strong><strong>path</strong><strong>,</strong><strong>config</strong> – see cherrypy.quickstart</p></li>
<li><p><strong>pidfile</strong><strong>,</strong><strong>daemonize</strong><strong>,</strong><strong>autoreload</strong><strong>,</strong><strong>autoupdate</strong> – see command-line options</p></li>
<li><p><strong>callback</strong> – optional callback function scheduled after daemonizing</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="examples.html" class="btn btn-neutral float-right" title="examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="engine.html" class="btn btn-neutral float-left" title="engine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Aric Coady

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>